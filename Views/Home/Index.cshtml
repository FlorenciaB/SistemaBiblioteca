@model List<SistemaBiblioteca.Models.MaterialBibliografico>

@{
    ViewData["Title"] = "Buscar Libros";
}

<h1 class="text-center mb-4">🔎 Buscar Libros</h1>

<!-- Filtros predictivos -->
<div class="row g-3 mb-4">
    <div class="col-md-3">
        <label class="form-label">Título:</label>
        <input type="text" id="filtroTitulo" class="form-control" placeholder="Buscar por título">
    </div>
    <div class="col-md-3">
        <label class="form-label">Autor:</label>
        <input type="text" id="filtroAutor" class="form-control" placeholder="Buscar por autor">
    </div>
    <div class="col-md-3">
        <label class="form-label">Materia:</label>
        <input type="text" id="filtroMateria" class="form-control" placeholder="Buscar por materia">
    </div>
    <div class="col-md-2 align-self-end">
        <button id="btnReset" class="btn btn-secondary w-100">🧹 Limpiar</button>
    </div>
</div>

@if (Model != null && Model.Any())
{
    <div class="table-responsive">
        <table id="tablaMateriales" class="table table-striped table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th>Título</th>
                    <th>Autor</th>
                    <th>Materia</th>
                    <th>Cantidad disponible</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var libro in Model)
                {
                    <tr>
                        <td>@libro.Titulo</td>
                        <td>@libro.Autor</td>
                        <td>@string.Join(", ", libro.Materias)</td>
                        <td class="fw-bold @(libro.Cantidad == 0 ? "text-danger" : "")">
                            @(libro.Cantidad > 0 ? libro.Cantidad.ToString() : "❌ Agotado")
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
else
{
    <p class="text-muted mt-4 text-center">No se encontraron libros con esos criterios.</p>
}

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" />

    <script>
        $(document).ready(function () {

            var table = $('#tablaMateriales').DataTable({
                "order": [],
                "pageLength": 10, // cantidad inicial
                "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "Todos"]],
                "dom": 'lfrtip', // << ACTIVAR SELECTOR DE CANTIDAD
                "language": {
                    "url": "//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json"
                }
            });

            // Filtros individuales
            $('#filtroTitulo').on('input', function () {
                table.column(0).search(this.value).draw();
            });

            $('#filtroAutor').on('input', function () {
                table.column(1).search(this.value).draw();
            });

            $('#filtroMateria').on('input', function () {
                table.column(2).search(this.value).draw();
            });

            // Botón limpiar
            $('#btnReset').on('click', function () {
                $('#filtroTitulo').val('');
                $('#filtroAutor').val('');
                $('#filtroMateria').val('');
                table.columns().search('').draw();
            });
        });
    </script>
}
